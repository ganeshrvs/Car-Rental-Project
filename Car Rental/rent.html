<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Car Rental</title>
  <style>
    * { box-sizing: border-box; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 0; }
    body { background: url("https://images.unsplash.com/photo-1503376780353-7e6692767b70?auto=format&fit=crop&w=1470&q=80") no-repeat center center fixed; background-size: cover; min-height: 100vh; }
    .container { display: flex; background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(6px); min-height: 100vh; }
    .sidebar { width: 220px; background: #2c3e50; color: white; padding: 20px; display: flex; flex-direction: column; }
    .sidebar h2 { text-align: center; margin-bottom: 20px; }
    .user { text-align: center; margin-bottom: 20px; }
    .user .avatar { font-size: 40px; margin-bottom: 10px; }
    .sidebar nav a { display: block; padding: 10px; margin: 10px 0; text-decoration: none; background: #34495e; color: white; border-radius: 8px; transition: background 0.3s ease; }
    .sidebar nav a:hover, .sidebar nav a.active { background: #2980b9; }
    .main-content { flex: 1; padding: 30px; }
    .form-panel { display: flex; justify-content: space-between; flex-wrap: wrap; gap: 20px; margin-bottom: 30px; }
    .form-box { flex: 1; min-width: 280px; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
    label { display: block; margin: 10px 0 5px; font-weight: bold; }
    input, select { width: 100%; padding: 8px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 6px; }
    .price-display span { display: block; margin: 10px 0; font-weight: bold; }
    .confirm-btn { margin-top: 10px; padding: 10px; background: #2ecc71; border: none; color: white; font-weight: bold; border-radius: 6px; cursor: pointer; }
    .card-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; }
    .car-card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 6px 10px rgba(0,0,0,0.1); text-align: center; cursor: pointer; transition: transform 0.3s ease; }
    .car-card:hover { transform: translateY(-5px); }
    .car-card img { width: 100%; height: 120px; object-fit: contain; margin-bottom: 10px; }
    .car-card h3 { margin-bottom: 5px; }
    .available { color: green; font-weight: bold; }
    .car-card.selected { border: 2px solid #2980b9; box-shadow: 0 0 10px #2980b9; }
  </style>
</head>
<body>
  <div class="container">
    <div class="sidebar">
      <div>
        <h2>Car Rentals</h2>
        <div class="user">
          <div class="avatar">üë§</div>
          <p>Nataraj service</p>
        </div>
        <nav>
          <a href="dashboard.html">üè† Dashboard</a>
          <a href="#" class="active">üöó Rent A Car</a>
          <a href="recharge.html">üí≥ Recharge</a>
        </nav>
      </div>
    </div>

    <div class="main-content">
      <h1>Rent A Car</h1>
      <!-- Removed action attribute, only using JS redirect -->
      <form onsubmit="return beforeSubmit();">
        <div class="form-panel">
          <div class="form-box">
            <label for="car-id">Car ID:</label>
            <select id="car-id" name="car-id">
              <option>1233</option>
              <option>5020</option>
              <option>1293</option>
            </select>

            <label for="rent-date">Rent Date:</label>
            <input type="date" id="rent-date" name="rent-date" required>

            <label for="return-date">Return Date:</label>
            <input type="date" id="return-date" name="return-date" required>

            <label for="full-name">Full Name:</label>
            <input type="text" id="full-name" name="full-name" placeholder="Enter your name" required>

            <label for="phone">Phone Number:</label>
            <input type="tel" id="phone" name="phone" placeholder="Enter your phone number" required pattern="[0-9]{10}" title="Enter 10-digit phone number">

            <label for="location">Pickup Location:</label>
            <input type="text" id="location" name="location" placeholder="Enter pickup location" required>
          </div>

          <div class="form-box price-display">
            <label>Current Balance:</label>
            <span id="current-balance">$500.00</span>

            <label>Cost Total:</label>
            <span id="cost-total">$0.00</span>

            <label>New Balance:</label>
            <span id="new-balance">$500.00</span>

            <!-- Hidden fields -->
            <input type="hidden" name="selectedPrice" id="selectedPrice" />
            <input type="hidden" name="hiddenCarId" id="hiddenCarId" />
            <input type="hidden" name="hiddenRentDate" id="hiddenRentDate" />
            <input type="hidden" name="hiddenReturnDate" id="hiddenReturnDate" />
            <button class="confirm-btn" type="submit">Confirm & Pay</button>
          </div>
        </div>
      </form>

      <h2>Available Cars</h2>
      <div class="card-grid" id="carGrid"></div>
    </div>
  </div>

  <script>
    const cardsContainer = document.getElementById("carGrid");
    const costTotal = document.getElementById("cost-total");
    const currentBalanceEl = document.getElementById("current-balance");
    const newBalanceEl = document.getElementById("new-balance");
    const rentDateInput = document.getElementById("rent-date");
    const returnDateInput = document.getElementById("return-date");

    // Persist wallet across pages
    if (localStorage.getItem("walletBalance") === null) {
      localStorage.setItem("walletBalance", "500");
    }
    let userBalance = parseFloat(localStorage.getItem("walletBalance") || "500");

    let selectedCar = null;
    let selectedCarPrice = 0;

    const defaultCars = [
      { name: "Nissan", price: 200, image: "img/Nissan.jpg" },
      { name: "TVS", price: 60, image: "img/TVS.jpg" },
      { name: "BMW", price: 150, image: "img/Bm.jpg" },
      { name: "Hyundai", price: 180, image: "img/Hyundai.jpg" },
      { name: "Mercedes", price: 250, image: "https://cdn.pixabay.com/photo/2015/01/19/13/51/car-604019_960_720.jpg" },
      { name: "Kia", price: 170, image: "img/Kia.jpg" },
      { name: "Toyota", price: 190, image: "img/Toyota.jpg" },
      { name: "Honda", price: 165, image: "img/Honda.webp" },
      { name: "Skoda", price: 210, image: "img/Suzuki.jpg" },
      { name: "Audi", price: 260, image: "img/ord.jpg" },
      { name: "Jeep", price: 240, image: "img/jeep.jpg" },
      { name: "Renault", price: 155, image: "img/renu.jpg" }
    ];

    function loadCars() {
      cardsContainer.innerHTML = "";
      const stored = JSON.parse(localStorage.getItem("addedCars") || "[]");
      const allCars = defaultCars.concat(stored);

      allCars.forEach((car) => {
        const price = Number(car.price);
        const card = document.createElement("div");
        card.className = "car-card";
        card.setAttribute("data-price", price);

        card.innerHTML = `
          <img src="${car.image}" alt="${car.name}" />
          <h3>${car.name}</h3>
          <p><strong>$${price}</strong> per day</p>
          <p class="available">Available</p>
        `;

        card.addEventListener("click", () => {
          document.querySelectorAll(".car-card").forEach(c => c.classList.remove("selected"));
          card.classList.add("selected");

          selectedCar = car.name;
          selectedCarPrice = price;
          updateCost();
        });

        cardsContainer.appendChild(card);
      });
    }

    function updateCost() {
      const rentDate = new Date(rentDateInput.value);
      const returnDate = new Date(returnDateInput.value);
      let days = 1;

      if (rentDateInput.value && returnDateInput.value && returnDate >= rentDate) {
        const diffTime = returnDate - rentDate;
        days = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1; // inclusive
      }

      const totalCost = selectedCarPrice * days;
      costTotal.textContent = `$${totalCost.toFixed(2)}`;
      currentBalanceEl.textContent = `$${userBalance.toFixed(2)}`;
      newBalanceEl.textContent = `$${(userBalance - totalCost).toFixed(2)}`;

      document.getElementById("selectedPrice").value = totalCost;
    }

    function beforeSubmit() {
      const selectedCard = document.querySelector(".car-card.selected");
      if (!selectedCard) {
        alert("Please select a car.");
        return false;
      }
      if (!rentDateInput.value || !returnDateInput.value) {
        alert("Please select both rent and return dates.");
        return false;
      }

      // Hidden values
      document.getElementById("hiddenCarId").value = document.getElementById("car-id").value;
      document.getElementById("hiddenRentDate").value = rentDateInput.value;
      document.getElementById("hiddenReturnDate").value = returnDateInput.value;

      // Save booking data
      const totalCostNumber = Number(document.getElementById("selectedPrice").value) || 0;
      const rentData = {
        car: selectedCar,
        carId: document.getElementById("car-id").value,
        rentDate: rentDateInput.value,
        returnDate: returnDateInput.value,
        name: document.getElementById("full-name").value,
        phone: document.getElementById("phone").value,
        location: document.getElementById("location").value,
        price: totalCostNumber,
        priceFormatted: `$${totalCostNumber.toFixed(2)}`
      };
      localStorage.setItem("rentData", JSON.stringify(rentData));

      // Redirect to recharge page
      window.location.href = "recharge.html";
      return false;
    }

    rentDateInput.addEventListener("change", updateCost);
    returnDateInput.addEventListener("change", updateCost);

    currentBalanceEl.textContent = `$${userBalance.toFixed(2)}`;
    newBalanceEl.textContent = `$${userBalance.toFixed(2)}`;

    loadCars();
  </script>
</body>
</html>
